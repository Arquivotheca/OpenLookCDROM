# CC	= cc
CC	= gcc -Wall -Wshadow -Wcast-qual -Wwrite-strings -Wpointer-arith
CFLAGS	= -O
PROGS	= tester hbftobdf hbfcmp hbflist
BUNDLE	= hbf.tar.Z

all: $(PROGS)

%: %.o hbf.o
	$(CC) $(CFLAGS) -o $@ $*.o hbf.o

clobber clean:
	rm -f *.o core LOG a.out $(PROGS)

distr:	clobber
	cd ..; tar cf - hbf >$(BUNDLE); ftpput ifcss.org incoming/$(BUNDLE)
	rm -f ../$(BUNDLE)

depend:
	(echo '/^#.* PUT NO STUFF BELOW/,$$d'; echo w; echo q) | ed - Makefile
	echo '# Dependencies generated by make depend: PUT NO STUFF BELOW' >>Makefile
	for file in *.c;\
	do	$(CC) $(CPPFLAGS) -E $$file |\
			sed -n 's|^# [1-9][0-9]* "\([^/].*\.h\)".*|\1|p' |\
			sed -e 's|/\./|.|g' -e "s/^/`basename $$file .c`.o: /";\
	done | sort -u | awk '{ if (LINE == 1) { line = last = $$1 }\
		else if ($$1 != last) { print line; line = last = $$1 }\
		line = line " " $$2 } END { print line }' >>Makefile

# Dependencies generated by make depend: PUT NO STUFF BELOW

hbf.o: hbf.h
hbfcmp.o: defs.h hbf.h
hbflist.o: defs.h hbf.h
hbftobdf.o: defs.h hbf.h
tester.o: hbf.h
